apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: webdav
  namespace: ingress-nginx
spec:
  selector:
    matchLabels:
      app: webdav
  replicas: 1
  template:
    metadata:
      labels:
        app: webdav
    spec:
      nodeSelector:
        beta.kubernetes.io/arch: arm64
      containers:
      - name: webdav
        image: arm64v8/httpd:2.4.33-alpine
        ports:
        - containerPort: 80
        volumeMounts:
          - name: webdav
            mountPath: /usr/local/apache2/webdav
          - name: http-config
            mountPath: /usr/local/apache2/conf/httpd.conf
            subPath: httpd.conf
          - name: http-webdav
            mountPath: /usr/local/apache2/conf/extra/httpd-dav.conf
            subPath: httpd-dav.conf
          - name: webdav-auth
            mountPath: /usr/local/apache2/conf/auth
      volumes:
        - name: webdav
          persistentVolumeClaim:
            claimName: webdav-data
        - name: http-config
          configMap:
            name: webdav-httpd-conf
        - name: http-webdav
          configMap:
            name: webdav-httpd-dav
        # kubectl create secret generic webdav-auth -n ingress-nginx --from-literal=webdav.passwd='username:auth:passwd'
        - name: webdav-auth
          secret:
            secretName: webdav-auth
