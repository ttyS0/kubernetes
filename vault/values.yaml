#helm template vault hashicorp/vault \
#  --namespace vault \
#  --version 0.24.0 \
#  --values values.yaml > vault.yaml
---
injector:
  enabled: true
server:
  dataStorage:
    storageClass: longhorn
  ingress:
    enabled: true
    ingressClassName: "nginx-internal"
    annotations: |
      kubernetes.io/tls-acme: "true"
    hosts:
      - host: vault.skj.dev
    tls:
      - secretName: vault-skj-dev-cert
        hosts:
          - vault.skj.dev
  extraContainers:
    - name: vault-unseal
      image: git.skj.dev/sean/vault-unseal:v1
      env:
        - name: UNSEAL_KEY_1
          valueFrom:
            secretKeyRef:
              name: vault-unseal
              key: unseal1
        - name: UNSEAL_KEY_2
          valueFrom:
            secretKeyRef:
              name: vault-unseal
              key: unseal2
        - name: UNSEAL_KEY_3
          valueFrom:
            secretKeyRef:
              name: vault-unseal
              key: unseal3
  standalone:
    enabled: false
  ha:
    enabled: true
    replicas: 3
    raft:
      enabled: true
      config: |
        ui = true
        
        cluster_name = "skj"
        
        api_addr = "https://vault.skj.dev"
        
        listener "tcp" {
          tls_disable = 1
          address = "[::]:8200"
          cluster_address = "[::]:8201"
        }
        
        storage "raft" {
          path = "/vault/data"
        }
        
        service_registration "kubernetes" {}
    disruptionBudget:
      maxUnavailable: 1
csi:
  enabled: false
