- op: replace
  path: /metadata/name
  value: skj
- op: replace
  path: /spec/template/spec/volumes
  value:
    - name: data
      persistentVolumeClaim:
        claimName: skj
- op: add
  path: /spec/template/metadata/annotations
  value:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: "kube-wikijs-skj"
    vault.hashicorp.com/agent-inject-secret-config.yml: "kube/data/wikijs/skj"
    vault.hashicorp.com/agent-inject-template-config.yml: |
      {{- with secret "kube/data/wikijs/skj" -}}
      port: 3000
      bindIP: 0.0.0.0
      db:
        type: {{ .Data.data.dbtype }}
        host: '{{ .Data.data.dbhost }}'
        port: {{ .Data.data.dbport }}'
        user: '{{ .Data.data.dbuser }}'
        pass: '{{ .Data.data.dbpass }}'
        db: {{ .Data.data.dbname }}
        storage: $(DB_FILEPATH)
        ssl: $(DB_SSL)
      ssl:
        enabled: $(SSL_ACTIVE)
        port: 3443
        provider: letsencrypt
        domain: $(LETSENCRYPT_DOMAIN)
        subscriberEmail: $(LETSENCRYPT_EMAIL)
      logLevel: $(LOG_LEVEL:info)
      logFormat: $(LOG_FORMAT:default)
      ha: $(HA_ACTIVE)
      {{- end }}
- op: add
  path: /spec/template/spec/serviceAccountName
  value: "wikijs-skj"

